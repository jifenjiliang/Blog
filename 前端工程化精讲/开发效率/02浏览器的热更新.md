<!--
 * @Description: 浏览器的热更新
 * @Autor: lijinpeng
 * @Date: 2021-03-10 23:55:01
 * @LastEditors: lijinpeng
-->
# webpack 和 webpack-dev-server
热更新是保存后自动编译（Auto Compile）吗？
还是自动刷新浏览器（Live Reload）？
还是指 HMR（Hot Module Replacement，模块热替换）

## 浏览器的热更新
指的是我们在本地开发的同时打开浏览器进行预览，当代码文件发生变化时，浏览器自动更新页面内容的技术。
这里的自动更新，表现上又分为自动刷新整个页面，以及页面整体无刷新而只更新页面的部分内容。

## webpack 中的热更新配置
### 1、一切依赖手动
### 2、Watch 模式  缺点是在浏览器里依然需要手动点击刷新才能看到变更后的效果
### 3、Live Reload
需要一种通信机制来连接浏览器中的预览页面与本地监控代码变更的进程
```
webpack.config.reload.js
{...
  devServer: {
    contentBase: './dist', //为./dist目录中的静态页面文件提供本地服务渲染
    open: true          //启动服务后自动打开浏览器网页
  }
...}
package.json
"scripts": {
  "dev:reload": "webpack-dev-server --config webpack.config.reload.js"
}
```
通过这个 websocket 链接，就可以使打开的网页和本地服务间建立持久化的通信。
当源代码发生变更时，我们就可以通过 Socket 通知到网页端，网页端在接到通知后会自动触发页面刷新
### 4、Hot Module Replacement
为了解决页面刷新导致的状态丢失问题，webpack 提出了模块热替换的概念
完整的 HMR 功能主要包含了三方面的技术：
对本地源代码文件内容变更的监控
浏览器网页端与本地服务器端的 Websocket 通信
模块解析与替换功能

## webpack 的打包思想可以简化为 3 点：
一切源代码文件均可通过各种 Loader 转换为 JS 模块 （module），模块之间可以互相引用
webpack 通过入口点（entry point）递归处理各模块引用关系，最后输出为一个或多个产物包 js(bundle) 文件。
每一个入口点都是一个块组（chunk group），在不考虑分包的情况下，一个 chunk group 中只有一个 chunk，
该 chunk 包含递归分析后的所有模块。每一个 chunk 都有对应的一个打包后的输出文件（asset/bundle）

## 模块热替换插件（HotModuleReplacementPlugin）
hot.accept 方法传入依赖模块名称和回调方法，当依赖模块发生更新时，其回调方法就会被执行，
而开发者就可以在回调中实现对应的替换逻辑，即上面的用更新的样式替换原标签中的样式。
另一个 hot.dispose 方法则是传入一个回调，当代码上下文的模块被移除时，其回调方法就会被执行。
例如当我们在源代码中移除导入的 CSS 模块时，运行时原有的模块中的 update() 就会被执行，
从而在页面移除对应的 style 标签。